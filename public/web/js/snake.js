(()=>{"use strict";var t={8980:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t,e,i,s,o){this._ctx=t,this.posX=e,this.posY=i,this._sprite=s,this._unitLength=o}draw(){this._ctx.drawImage(this._sprite,this.posX*this._unitLength,this.posY*this._unitLength,this._unitLength,this._unitLength)}updatePosition(t,e){this.posX=t,this.posY=e}}},629:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t,e,i,s,o,n){this._ctx=t,this._scoreElement=e,this._snake=i,this._food=s,this._gridSize=o,this._length=n,this._foodSpawnStride=13}start(){this._ctx.fillStyle="#fff",this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height),window.addEventListener("keydown",this._handleKeyDown.bind(this)),requestAnimationFrame((t=>{this._previousTimeStamp=t,requestAnimationFrame(this._gameLoop.bind(this))}))}get score(){return this._snake.size-3}_gameLoop(t){t-this._previousTimeStamp>80&&(this._draw(),this._previousTimeStamp=t),requestAnimationFrame(this._gameLoop.bind(this))}_draw(){this._ctx.fillStyle="#fff",this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height),this._food.draw(),this._snake.draw(),this._snake.isHeadAtPos(this._food.posX,this._food.posY)&&(this._snake.grow(),this._setNextFoodPosition(),this._updateScoreText()),this._ctx.fillStyle="#000";for(let t=1;t<this._gridSize;t++){const e=t*this._length-1;this._ctx.fillRect(e,0,1,this._ctx.canvas.height),this._ctx.fillRect(0,e,this._ctx.canvas.width,1)}}_handleKeyDown(t){switch(t.key.toLowerCase()){case"w":case"arrowup":this._snake.setDirection(0,-1);break;case"a":case"arrowleft":this._snake.setDirection(-1,0);break;case"s":case"arrowdown":this._snake.setDirection(0,1);break;case"d":case"arrowright":this._snake.setDirection(1,0)}}_setNextFoodPosition(){const t=this._gridSize*this._gridSize;let e=Math.floor(Math.random()*t);for(let i=0;i<t;i++){const i=e%this._gridSize,s=Math.floor(e/this._gridSize);if(!this._snake.contains(i,s)){this._food.updatePosition(i,s);break}e=(e+this._foodSpawnStride)%t}}_updateScoreText(){this._scoreElement.textContent=String(this.score)}}},6542:function(t,e,i){var s,o,n,r,a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const h=a(i(629)),d=a(i(6599)),c=a(i(8980)),l=i(36),_=document.createElement("canvas");null===(s=document.getElementById("canvas-container"))||void 0===s||s.appendChild(_),_.width=480,_.height=480;const u=_.getContext("2d",{alpha:!1});if(!u)throw new Error("2d context is not supported by browser");const p=null===(o=document.getElementById("score-field"))||void 0===o?void 0:o.getElementsByTagName("span")[0];if(!p)throw Error("score-field element not found");const f=null===(n=document.getElementById("name-field"))||void 0===n?void 0:n.getElementsByTagName("input")[0];if(!f)throw Error("name-field element not found");const m=null===(r=document.getElementById("submit-button"))||void 0===r?void 0:r.getElementsByTagName("button")[0];if(!m)throw Error("submit-button element not found");Promise.all([function(t){const e=new Image;return new Promise(((i,s)=>{e.onload=()=>{i(e)},e.onerror=()=>{s(`Could not load image [${t}]`)},e.src=t}))}("/images/apple.png"),(0,l.loadAudioBuffer)("/sounds/pop.wav")]).then((([t,e])=>{const i=new l.Sound(e),s=new d.default(u,f,m,i,16,30),o=new c.default(u,10,10,t,30),n=new h.default(u,p,s,o,16,30);m.addEventListener("click",(()=>{f.disabled=!0,m.disabled=!0;const t=f.value;if(t.length<3)return void alert("Name is too short");if(t.length>8)return void alert("Name is too long");const e={score:n.score,playerName:t};fetch("/snake/scores",{method:"put",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).then((()=>{window.location.reload()})).catch((t=>{console.error(t)})).finally((()=>{f.disabled=!1,m.disabled=!1}))})),n.start()})),fetch("/snake/scores").then((t=>{var e;const i=null===(e=document.getElementById("score-table"))||void 0===e?void 0:e.getElementsByTagName("tbody")[0];i?t.json().then((t=>{var e;for(const s of t){const t=i.insertRow(),o=t.insertCell(),n=document.createTextNode(String(s.score));o.appendChild(n);const r=t.insertCell(),a=document.createTextNode(s.playerName);r.appendChild(a);const h=t.insertCell(),d=document.createTextNode(null!==(e=s.creationDate)&&void 0!==e?e:"");h.appendChild(d)}})):console.warn("Score table body not found")})).catch((t=>{console.error(t)}))},6599:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t,e,i,s,o,n){this._ctx=t,this._nameInputElement=e,this._submitButtonElement=i,this._growSound=s,this._gridSize=o,this._unitLength=n,this.isDead=!1,this._dx=0,this._dy=0,this._posX=[5,4,3],this._posY=[10,10,10]}draw(){this.isDead||(this.isDead=this._hasCollided(),this.isDead&&(this._nameInputElement.disabled=!1,this._submitButtonElement.disabled=!1)),this.isStationary()||this.isDead||(this._posX.unshift(this._posX[0]+this._dx),this._posY.unshift(this._posY[0]+this._dy),this._posX.pop(),this._posY.pop()),this._ctx.fillStyle=this.isDead?"#880000":"#008800";for(let t=0;t<this.size;t++)this._ctx.fillRect(this._posX[t]*this._unitLength,this._posY[t]*this._unitLength,this._unitLength,this._unitLength)}setDirection(t,e){const i=this._posX[0]-this._posX[1],s=this._posY[0]-this._posY[1];i*t<0||s*e<0||(this._dx=t,this._dy=e)}grow(){this._growSound.play();const t=this.size;this._posX.push(2*this._posX[t-1]-this._posX[t-2]),this._posY.push(2*this._posY[t-1]-this._posY[t-2])}isStationary(){return 0===this._dx&&0===this._dy}_hasCollided(){for(let t=1;t<this.size;t++)if(this._posX[0]===this._posX[t]&&this._posY[0]===this._posY[t])return!0;return this._posX[0]<0||this._posX[0]>=this._gridSize||this._posY[0]<0||this._posY[0]>=this._gridSize}get size(){return this._posX.length}isHeadAtPos(t,e){return this._posX[0]===t&&this._posY[0]===e}contains(t,e){for(let i=0;i<this.size;i++)if(this._posX[i]===t&&this._posY[i]===e)return!0;return!1}}},36:function(t,e){var i,s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(o,n){function r(t){try{h(s.next(t))}catch(t){n(t)}}function a(t){try{h(s.throw(t))}catch(t){n(t)}}function h(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}h((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.loadAudioBuffer=e.Sound=void 0;const o=new(null!==(i=window.AudioContext)&&void 0!==i?i:window.webkitAudioContext),n=o.createGain();n.connect(o.destination),e.Sound=class{constructor(t){this._audioBuffer=t,this._gainNode=o.createGain(),this._gainNode.connect(n)}play(){const t=o.createBufferSource();t.buffer=this._audioBuffer,t.loop=!1,t.connect(this._gainNode),t.start()}},e.loadAudioBuffer=function(t){return s(this,void 0,void 0,(function*(){const e=yield(yield fetch(t)).arrayBuffer();return new Promise(((t,i)=>{o.decodeAudioData(e,(e=>t(e)),(t=>i(t)))}))}))}}},e={};!function i(s){var o=e[s];if(void 0!==o)return o.exports;var n=e[s]={exports:{}};return t[s].call(n.exports,n,n.exports,i),n.exports}(6542)})();